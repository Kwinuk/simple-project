<?xml version="1.0" encoding="UTF-8"?> <!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.project.boardproject.api.board.mapper.BoardMapper">

    <insert id="insertBoard" parameterType="com.project.boardproject.api.board.model.BoardDTO">
        INSERT INTO
        board
        (uid, title, content, writer, write_date)
        VALUES
        (#{uId}, #{title}, #{content}, #{writer}, NOW())
    </insert>

    <select id="boardList" resultType="com.project.boardproject.api.board.model.BoardDTO">
            SELECT * FROM BOARD
    </select>

    <select id="boardDetail" parameterType="int" resultType="com.project.boardproject.api.board.model.BoardDTO">
        SELECT
            b.bid, b.uid, b.title, b.content, b.writer, b.write_date
        FROM
            board b INNER JOIN user u ON b.uid = u.uid
        WHERE
             b.bid = #{bId};
    </select>

    <select id="findBid" resultType="int">
        SELECT
            MAX(bid) AS bid
        FROM
            board
    </select>

    <!-- 게시물 총 개수 구하기 -->
    <select id="getCount" resultType="int">
        SELECT count(*) as listCnt
        FROM board
    </select>
    
    <select id="getListPage" parameterType="com.project.boardproject.api.board.model.PaginationVO" resultType="com.project.boardproject.api.board.model.BoardDTO">
        SELECT
            b.bid, b.writer, b.title, b.write_date, v.view_cnt, b.is_use
        FROM
            board b JOIN view v
        ON
            b.bid = v.bid
        ORDER BY bid DESC
        LIMIT #{rowCount}
            OFFSET #{offset}
    </select>

    <update id="updateBoard" parameterType="int">
        UPDATE
        BOARD
        SET
            title = ${title}, content = ${content}
        WHERE
            bid = ${bId}
    </update>

    <update id="updateBoardState" parameterType="int">
        UPDATE
        BOARD
        SET
            is_use = 2
        WHERE
            bid = ${bId}
    </update>
    
    <select id="popularBoard" resultType="com.project.boardproject.api.board.model.BoardDTO">
        SELECT
            b.bid, b.writer, b.title, b.write_date, v.view_cnt, b.is_use
        FROM
            board b JOIN view v
                         ON
                             b.bid = v.bid
        ORDER BY view_cnt DESC
        LIMIT #{rowCount}
            OFFSET #{offset}
    </select>

</mapper>